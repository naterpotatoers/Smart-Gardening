FROM        node:latest
ENV         PORT=5000
COPY        . /src
WORKDIR     /src

ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_DEFAULT_REGION
ARG AWS_RDS_HOST
ARG AWS_RDS_USERNAME
ARG AWS_RDS_PASSWORD
ARG AWS_RDS_DATABASE
ARG AWS_S3_BUCKET

ENV AWS_ACCESS_KEY_ID $AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY $AWS_SECRET_ACCESS_KEY
ENV AWS_DEFAULT_REGION $AWS_DEFAULT_REGION
ENV AWS_RDS_HOST $AWS_RDS_HOST
ENV AWS_RDS_USERNAME $AWS_RDS_USERNAME
ENV AWS_RDS_PASSWORD $AWS_RDS_PASSWORD
ENV AWS_RDS_DATABASE $AWS_RDS_DATABASE
ENV AWS_S3_BUCKET $AWS_S3_BUCKET

RUN         npm install
EXPOSE      5000
COPY . .
RUN         npm run build
ENTRYPOINT  ["node", "dist/main"]